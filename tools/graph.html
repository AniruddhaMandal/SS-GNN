<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>3D Force Graph â€” drag nodes</title>
  <style>
    html,body{ height:100%; margin:0; }
    #3d-graph { width:100%; height:100vh; }
    .label {
      pointer-events: none;
      font-family: Arial, sans-serif;
      font-size: 12px;
      color: #222;
      background: rgba(255,255,255,0.8);
      padding: 2px 6px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="3d-graph"></div>

  <!-- three.js + 3d-force-graph from UNPKG CDN -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://unpkg.com/3d-force-graph"></script>

  <script>
    // helper to load graph.json (works when served over http)
    fetch('graph_json_data/graph.json').then(r => r.json()).then(data => {
      const Graph = ForceGraph3D()
        (document.getElementById('3d-graph'))
        .graphData(data)
        .nodeColor(node => node.color || null)
        .nodeAutoColorBy(node => node.color ? null : 'group')
        .nodeAutoColorBy('group')    // color nodes by group if present
        .nodeLabel(node => `id: ${node.id}`)
        .nodeRelSize(12)
        .linkWidth(() => 1)
        .linkOpacity(0.6)
        .d3AlphaDecay(0.02)          // tweak physics: lower = slower but more stable
        .onNodeDragEnd(node => {
          // Pin node when user drops it (optional)
          node.fx = node.x;
          node.fy = node.y;
          node.fz = node.z;
        });

      // Optional: unpin all nodes on right-click
      window.addEventListener('contextmenu', e => {
        e.preventDefault();
        Graph.graphData().nodes.forEach(n => {
          delete n.fx; delete n.fy; delete n.fz;
        });
      });

      // Optional: click to show node label in DOM
      Graph.onNodeClick(node => {
        // center camera on node
        const dist = 100;
        const pos = { x: node.x, y: node.y, z: node.z };
        const camera = Graph.camera();
        // smoothly move camera (simple)
        camera.position.set(pos.x + dist, pos.y + dist, pos.z + dist);
        camera.lookAt(pos.x, pos.y, pos.z);
      });

      // make node drag sensitivity a bit nicer
      Graph.renderer().domElement.style.cursor = 'grab';
    }).catch(err => {
      document.body.innerHTML = "<pre style='color:red'>Failed to load graph.json. If you opened this file with file://, run a local HTTP server instead. See instructions.</pre>";
      console.error(err);
    });
  </script>
</body>
</html>
